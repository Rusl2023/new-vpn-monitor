name: Test Xray Checker

on:
  workflow_dispatch:

jobs:
  test-xray:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create test VLESS file
        run: |
          mkdir -p githubmirror
          echo "vless://test@google.com:443?encryption=none#TEST" > githubmirror/test.txt
          echo "Created test file:"
          cat githubmirror/test.txt

      - name: Pull Xray Checker image
        run: docker pull kutovoys/xray-checker:latest

      - name: Run Xray Checker (DEBUG)
        run: |
          docker run --rm \
            -v "${GITHUB_WORKSPACE}/githubmirror:/app/input_output" \
            kutovoys/xray-checker:latest \
            --input /app/input_output/test.txt \
            --output /app/input_output/test_out.txt \
            --timeout 1000 \
            --ping || true

      - name: Show results
        run: |
          echo "Listing githubmirror:"
          ls -la githubmirror
          echo "Output file content:"
          cat githubmirror/test_out.txt || echo "NO OUTPUT FILE"
